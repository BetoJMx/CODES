SELECT
    PAPF.PERSON_NUMBER,
    PAPF.PERSON_ID,
    PY.PAYROLL_NAME
FROM
    PER_ALL_ASSIGNMENTS_M    PAAM,
    PER_ALL_PEOPLE_F         PAPF,
    PAY_ALL_PAYROLLS_F       PY,
    --PAY_PAYROLL_ACTIONS      PPA,
    --PAY_PAYROLL_REL_ACTIONS  PRA,
    PAY_ASSIGNED_PAYROLLS_DN APD,
    PAY_PAYROLL_TERMS        PT,
    PAY_REL_GROUPS_DN        PRG
WHERE
    1=1
    --AND PRA.PAYROLL_ACTION_ID = PPA.PAYROLL_ACTION_ID
    --AND PPA.ACTION_TYPE IN ('R')
    --AND PTP.PERIOD_CATEGORY = 'E'
    --AND PRG.PAYROLL_RELATIONSHIP_ID = PRA.PAYROLL_RELATIONSHIP_ID
    AND PT.PAYROLL_TERM_ID = APD.PAYROLL_TERM_ID
    AND PY.PAYROLL_ID = APD.PAYROLL_ID
    --AND PTP.PAYROLL_ID = PY.PAYROLL_ID
    --AND PRA.SOURCE_ACTION_ID IS NULL
    AND PAAM.PRIMARY_FLAG ='Y'
    AND PT.HR_TERM_ID = PRG.TERM_ID
    AND TRUNC(SYSDATE)  BETWEEN PY.EFFECTIVE_START_DATE
                        AND PY.EFFECTIVE_END_DATE
    AND TRUNC(SYSDATE)  BETWEEN PAAM.EFFECTIVE_START_DATE
                        AND PAAM.EFFECTIVE_END_DATE
    AND PAAM.ASSIGNMENT_ID = PRG.ASSIGNMENT_ID
    --AND PCS.CONSOLIDATION_SET_ID = NVL(PPA.CONSOLIDATION_SET_ID,PY.CONSOLIDATION_SET_ID)
    AND PAAM.ASSIGNMENT_TYPE = 'E'
    AND PAPF.PERSON_ID = PAAM.PERSON_ID
    AND TRUNC(SYSDATE)  BETWEEN PAPF.EFFECTIVE_START_DATE
                        AND PAPF.EFFECTIVE_END_DATE
    AND PT.START_DATE   =   (
                                SELECT  MAX(PT1.START_DATE)
                                FROM    PAY_PAYROLL_TERMS PT1
                                WHERE   PT.PAYROLL_TERM_ID = PT1.PAYROLL_TERM_ID
                            )
ORDER BY
    1
